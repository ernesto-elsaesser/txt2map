<html>
  <head>
    <title>txt2map</title>
    <style>
      .container { margin: 20px auto; text-align: center; }
      .textbox { width: 80%; height: 300px; margin: 0 auto 20px; }
      a { color: blue; font-weight: bold; cursor: pointer; }
      label { margin: 0 20px 0 5px; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Input</h1>
      <textarea class="textbox" id="input"></textarea><br/>
      <input type="radio" id="accept-text" name="accept" checked>
      <label for="accept-text">short text output</label>
      <input type="radio" id="accept-json" name="accept">
      <label for="accept-json">full JSON output</label><br /><br />
      <a onclick="post()" id="button">PARSE</a><br />
      <h1>Output</h1>
      <textarea class="textbox" id="output"></textarea>
      <p>Source: <a href="https://github.com/ernesto-elsaesser/txt2map">https://github.com/ernesto-elsaesser/txt2map</a></p>
    </div>

    <script>
    var input = document.getElementById('input');
    var accept = document.getElementById('accept-text');
    var button = document.getElementById('button');
    var output = document.getElementById('output');

    function post() {

      output.value = '';

      var params = {
        method: 'POST',
        body: input.value
      }

      if (accept.checked) {
        params.headers = { 'Accept': 'text/plain' }
      }

      toggle(true);
      fetch('/', params)
      .then(function (res) {
        res.text().then(finish);
      }).catch(function (err) {
        finish(err.toString(), true)
      });
    }

    function finish(text, failed) {
      if (failed) {
        output.style.color = 'red';
      } else {
        output.style.color = 'black';
      }
      
      if (text == '') {
        text = 'Nothing found.'
      }
      output.value = text;
      toggle(false);
    }

    function toggle(loading) {
      if (loading) {
        button.innerHTML = 'LOADING ...';
        button.style.color = 'grey';
        button.onclick = '';
      } else {
        button.innerHTML = 'PARSE';
        button.style.color = 'blue';
        button.onclick = post;
      }
    }
    </script>
  </body>
</html>